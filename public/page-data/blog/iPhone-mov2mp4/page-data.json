{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/iPhone-mov2mp4/","result":{"data":{"site":{"siteMetadata":{"title":"Developer's blog"}},"markdownRemark":{"id":"8d8153c8-ffc2-54bf-acc6-46e411c07fa2","excerpt":"iPhone で撮影した動画は通常、「.MOV」または「.mov」という拡張子で保存されています。この拡張子は Apple の QuickTime フォーマットを示します。ここでは、動画ファイルのファイル名を撮影日時に基づいて変更する方法と、ファイル形式を MOV から MP…","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%81%AE%E5%A4%89%E6%8F%9B\">ファイル名の変換</a></p>\n<ul>\n<li><a href=\"#mov-%E3%82%92-mp4-%E3%81%AB%E5%A4%89%E6%8F%9B\">mov を mp4 に変換</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\">参考文献</a></p>\n</li>\n</ul>","html":"<p>iPhone で撮影した動画は通常、「.MOV」または「.mov」という拡張子で保存されています。この拡張子は Apple の QuickTime フォーマットを示します。ここでは、動画ファイルのファイル名を撮影日時に基づいて変更する方法と、ファイル形式を MOV から MP4 に変換する方法を説明します。</p>\n<h2 id=\"ファイル名の変換\" style=\"position:relative;\"><a href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%81%AE%E5%A4%89%E6%8F%9B\" aria-label=\"ファイル名の変換 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ファイル名の変換</h2>\n<p>まず、動画ファイル名に撮影日時のタイムスタンプを追加します。以下の手順に従ってください。</p>\n<p><strong>動画のメタデータを取得</strong></p>\n<p>ファイル名に動画のタイムスタンプを追加するために、ffprobe を用いて動画のメタデータを取得します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ ffprobe filename\n\nMetadata:\n    major_brand     <span class=\"token builtin class-name\">:</span> qt\n    minor_version   <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0</span>\n    compatible_brands: qt\n    creation_time   <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2023</span>-11-23T05:27:30.000000Z\n    com.apple.quicktime.make: Apple\n    com.apple.quicktime.model: iPhone SE <span class=\"token punctuation\">(</span>2nd generation<span class=\"token punctuation\">)</span>\n    com.apple.quicktime.software: <span class=\"token number\">16.6</span>\n    com.apple.quicktime.creationdate: <span class=\"token number\">2023</span>-09-12T12:17:33+0900</code></pre></div>\n<p>撮影日の情報は、<code class=\"language-text\">com.apple.quicktime.creationdate</code>の値で分かります。この情報だけを<code class=\"language-text\">grep</code>コマンドを用いて抽出します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ ffprobe filename <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-i</span> com.apple.quicktime.creationdate</code></pre></div>\n<p><strong>ファイル名の命名規則</strong></p>\n<p>ファイル名の命名規則は次のようにします。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yyyy-mm-dd_HH-MM-SS.mov</code></pre></div>\n<p>同一階層にある MOV ファイルを撮影日でファイル名を一括変更するスクリプトを以下に示します。</p>\n<p>スクリプトファイル（<code class=\"language-text\">rename.sh</code>）</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token comment\"># ファイル名の変更処理をループで実行</span>\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">file</span> <span class=\"token keyword\">in</span> *.MOV<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span>\n    <span class=\"token comment\"># ffprobeコマンドでcreationdateを取得し、日付情報のみを抽出</span>\n    <span class=\"token assign-left variable\">creation_date</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>ffprobe <span class=\"token string\">\"<span class=\"token variable\">$file</span>\"</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-i</span> com.apple.quicktime.creationdate <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">':'</span> <span class=\"token parameter variable\">-f</span> <span class=\"token number\">2</span>- <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/^[ \\t]*//;s/[ \\t]*$//'</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">' '</span> <span class=\"token parameter variable\">-f</span> <span class=\"token number\">2</span><span class=\"token variable\">)</span></span>\n\n    <span class=\"token comment\"># 日付情報を所望の形式に変換</span>\n    <span class=\"token assign-left variable\">formatted_date</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"<span class=\"token variable\">$creation_date</span>\"</span> +<span class=\"token string\">\"%Y-%m-%d_%H-%M-%S\"</span><span class=\"token variable\">)</span></span>\n\n    <span class=\"token comment\"># 新しいファイル名を生成</span>\n    <span class=\"token assign-left variable\">new_filename</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${formatted_date}</span>.mov\"</span>\n\n    <span class=\"token comment\"># 新しいファイル名で保存</span>\n    <span class=\"token function\">mv</span> <span class=\"token string\">\"<span class=\"token variable\">$file</span>\"</span> <span class=\"token string\">\"<span class=\"token variable\">$new_filename</span>\"</span>\n<span class=\"token keyword\">done</span></code></pre></div>\n<p>日付は上記の<code class=\"language-text\">ffprobe</code>コマンドからメタデータから取得します。</p>\n<h3 id=\"mov-を-mp4-に変換\" style=\"position:relative;\"><a href=\"#mov-%E3%82%92-mp4-%E3%81%AB%E5%A4%89%E6%8F%9B\" aria-label=\"mov を mp4 に変換 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mov を mp4 に変換</h3>\n<p>MOV 形式のファイルを MP4 形式に変換するスクリプトを紹介します。</p>\n<p>スクリプトファイル（<code class=\"language-text\">mov2mp4.sh</code>）</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token function-name function\">process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin class-name\">local</span> <span class=\"token assign-left variable\">mov</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span>\n        <span class=\"token builtin class-name\">local</span> <span class=\"token assign-left variable\">mp4</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token string\">\"<span class=\"token variable\">$mov</span>\"</span> .mov<span class=\"token variable\">)</span></span>.mp4\n        <span class=\"token builtin class-name\">echo</span> Processing <span class=\"token string\">\"<span class=\"token variable\">$mov</span> ...\"</span>\n        ffmpeg <span class=\"token parameter variable\">-i</span> <span class=\"token string\">\"<span class=\"token variable\">$mov</span>\"</span> <span class=\"token parameter variable\">-vcodec</span> h264 <span class=\"token parameter variable\">-acodec</span> mp2 <span class=\"token string\">\"<span class=\"token variable\">$mp4</span>\"</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Waiting to delete the original file: <span class=\"token variable\">$mov</span>\"</span>\n        <span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n        <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$mov</span>\"</span>\n        <span class=\"token builtin class-name\">echo</span> Remaining MOV count <span class=\"token operator\">=</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-name</span> <span class=\"token string\">\"*.mov\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"OK!\"</span>\n        <span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token parameter variable\">-f</span> process\n\n<span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-name</span> <span class=\"token string\">\"*.mov\"</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-exec</span> <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'process \"{}\"'</span> <span class=\"token punctuation\">\\</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上記スクリプトでエンコードされ、ファイル拡張子も<code class=\"language-text\">.mov</code>から<code class=\"language-text\">.mp4</code>に自動的に変換されます。</p>\n<p>また、<code class=\"language-text\">xargs</code>はオプションで並列実行することが可能です。<code class=\"language-text\">xargs</code>コマンドを用いてマルチプロセスで<code class=\"language-text\">ffmpeg</code>を実行し時短することに成功しました。以下がそのスクリプトです。</p>\n<p><code class=\"language-text\">mov2mp4.sh</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n<span class=\"token function-name function\">process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token builtin class-name\">local</span> <span class=\"token assign-left variable\">mov</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span>\n        <span class=\"token builtin class-name\">local</span> <span class=\"token assign-left variable\">mp4</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">basename</span> <span class=\"token string\">\"<span class=\"token variable\">$mov</span>\"</span> .mov<span class=\"token variable\">)</span></span>.mp4\n        <span class=\"token builtin class-name\">echo</span> Processing <span class=\"token string\">\"<span class=\"token variable\">$mov</span> ...\"</span>\n        ffmpeg <span class=\"token parameter variable\">-i</span> <span class=\"token string\">\"<span class=\"token variable\">$mov</span>\"</span> <span class=\"token parameter variable\">-vcodec</span> h264 <span class=\"token parameter variable\">-acodec</span> mp2 <span class=\"token string\">\"<span class=\"token variable\">$mp4</span>\"</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Waiting to delete the original file: <span class=\"token variable\">$mov</span>\"</span>\n        <span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n        <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"<span class=\"token variable\">$mov</span>\"</span>\n        <span class=\"token builtin class-name\">echo</span> Remaining MOV count <span class=\"token operator\">=</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-name</span> <span class=\"token string\">\"*.mov\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"OK!\"</span>\n        <span class=\"token function\">sleep</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token builtin class-name\">export</span> <span class=\"token parameter variable\">-f</span> process\n\n<span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> <span class=\"token parameter variable\">-name</span> <span class=\"token string\">\"*.mov\"</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token parameter variable\">-P</span> <span class=\"token number\">6</span> <span class=\"token parameter variable\">-I</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'process \"{}\"'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>このスクリプトでは、<code class=\"language-text\">xargs</code>を使用して並列処理を行い、効率的に MOV ファイルを MP4 に変換します。</p>\n<p>このように、iPhone で撮影した動画ファイルのファイル名を撮影日時に基づいて変更し、形式を MOV から MP4 に変換する方法をご紹介しました。ぜひ、これらのスクリプトを活用して、動画ファイルの管理をより簡単にしてください。</p>\n<h2 id=\"参考文献\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\" aria-label=\"参考文献 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考文献</h2>\n<ul>\n<li><a href=\"https://weblabo.oscasierra.net/ffmpeg-video-analizing/\">FFmpeg による動画ファイル分析入門</a></li>\n<li><a href=\"https://helloacm.com/batch-script-to-convert-mov-videos-to-mpg-using-ffmpeg/\">Batch Script to Convert MOV Videos to MP4/MPEG using ffmpeg</a></li>\n<li><a href=\"http://x68000.q-e-d.net/~68user/unix/pickup?local\">UNIX/Linux の部屋 local コマンドの使い方</a></li>\n<li><a href=\"https://www.xmisao.com/2013/09/01/how-to-use-find-and-xargs.html\">find と xargs の基本的な使い方 -- ぺけみさお</a></li>\n</ul>","frontmatter":{"title":"iPhone動画ファイルのファイル名変更と形式変換方法","date":"2024-06-06","description":"iPhoneで撮影した動画ファイルのファイル名を撮影日時に基づいて変更し、形式をMOVからMP4に変換する方法を詳しく説明します。","tags":["Linux","ffmpeg","xargs","ライフハック"],"featuredImage":{"publicURL":"/static/d20504ff5145c52c93fed74385acae97/pc-desk.jpg","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#d8d8d8","images":{"fallback":{"src":"/static/d20504ff5145c52c93fed74385acae97/3c367/pc-desk.jpg","srcSet":"/static/d20504ff5145c52c93fed74385acae97/19e71/pc-desk.jpg 128w,\n/static/d20504ff5145c52c93fed74385acae97/68974/pc-desk.jpg 256w,\n/static/d20504ff5145c52c93fed74385acae97/3c367/pc-desk.jpg 512w","sizes":"(min-width: 512px) 512px, 100vw"},"sources":[{"srcSet":"/static/d20504ff5145c52c93fed74385acae97/6766a/pc-desk.webp 128w,\n/static/d20504ff5145c52c93fed74385acae97/22bfc/pc-desk.webp 256w,\n/static/d20504ff5145c52c93fed74385acae97/d689f/pc-desk.webp 512w","type":"image/webp","sizes":"(min-width: 512px) 512px, 100vw"}]},"width":512,"height":512}}}}},"relatedPosts":{"nodes":[]},"previous":null,"next":{"fields":{"slug":"/4-months-pmp-exam-success/"},"frontmatter":{"title":"PMP受験記録"}}},"pageContext":{"id":"8d8153c8-ffc2-54bf-acc6-46e411c07fa2","previousPostId":null,"nextPostId":"b5b6aa6c-fa2e-500f-ad65-9d0735732692","relatedPosts":[]}},"staticQueryHashes":["2841359383"],"slicesMap":{}}